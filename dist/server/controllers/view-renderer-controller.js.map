{"version":3,"sources":["../../../src/server/controllers/view-renderer-controller.js"],"names":["AuthorizationHelper","Records","Constants","router","Router","get","req","res","next","iss","launch","query","authorize","url","redirect","console","log","code","state","accessToken","patient","model","html","renderToString","createElement","header","send"],"mappings":"AAAA;;;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;IAAYA,mB;;AACZ;;;;AACA;;AACA;;IAAYC,O;;AACZ;;IAAYC,S;;;;;;AAEZ,IAAMC,SAAS,kBAAQC,MAAR,EAAf;;AAEAD,OAAOE,GAAP,CAAW,GAAX,EAAgB,4CAAG,iBAAWC,GAAX,EAAgBC,GAAhB,EAAqBC,IAArB;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAEPC,uBAFO,GAED,IAFC,EAEKC,MAFL,GAEc,IAFd;AAAA,iCAGQJ,IAAIK,KAHZ;AAGRF,uBAHQ,cAGRA,GAHQ;AAGHC,0BAHG,cAGHA,MAHG;AAAA;AAAA,2BAIOV,oBAAoBY,SAApB,CAA8BH,GAA9B,EAAmCC,MAAnC,CAJP;;AAAA;AAILG,uBAJK;;AAKXN,wBAAIO,QAAJ,CAAaD,GAAb;AALW;AAAA;;AAAA;AAAA;AAAA;;AAOXE,4BAAQC,GAAR,CAAY,sBAAZ;AACAR;;AARW;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,CAAH,EAAhB;;AAYAL,OAAOE,GAAP,CAAW,WAAX,EAAwB,4CAAG,kBAAWC,GAAX,EAAgBC,GAAhB,EAAqBC,IAArB;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;;AAEnBO,4BAAQC,GAAR,CAAY,MAAZ;AACIC,wBAHe,GAGR,IAHQ,EAGFC,KAHE,GAGM,IAHN,EAGYC,WAHZ,GAG0B,IAH1B,EAGgCC,OAHhC,GAG0C,CAH1C;;AAInBL,4BAAQC,GAAR,CAAY,MAAZ;AAJmB,kCAKAV,IAAIK,KALJ;AAKhBM,wBALgB,eAKhBA,IALgB;AAKVC,yBALU,eAKVA,KALU;;AAMnBH,4BAAQC,GAAR,CAAY,MAAZ;AANmB;AAAA,2BAOChB,oBAAoBmB,WAApB,CAAgCF,IAAhC,EAAsCC,KAAtC,CAPD;;AAAA;AAObG,yBAPa;;AAQnBN,4BAAQC,GAAR,CAAY,kBAAiBK,MAAMH,KAAnC;AACAH,4BAAQC,GAAR,CAAYK,KAAZ;AACMC,wBAVa,GAUN,iBAAeC,cAAf,CACT,gBAAMC,aAAN,iBADS,CAVM;;AAanBjB,wBAAIkB,MAAJ,CAAW,EAAEP,YAAF,EAAX;AACAX,wBAAImB,IAAJ,CAASJ,IAAT;AAdmB;AAAA;;AAAA;AAAA;AAAA;;AAgBnBP,4BAAQC,GAAR,CAAY,uBAAZ;AACAR;;AAjBmB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,CAAH,EAAxB;;kBAqBeL,M","file":"view-renderer-controller.js","sourcesContent":["\"use strict\";\nimport express from 'express';\nimport React from 'react';\nimport ReactDomServer from 'react-dom/server';\nimport Component from '../index';\nimport * as AuthorizationHelper from '../helper/authorization-helper';\nimport co from '../util/wrap';\nimport {get} from '../service/http-service'\nimport * as Records from '../models/models';\nimport * as Constants from '../util/constants';\n\nconst router = express.Router();\n\nrouter.get('/', co(function* (req, res, next) {\n    try {\n        let iss = null, launch = null;\n        ({ iss, launch } = req.query);\n        const url = yield AuthorizationHelper.authorize(iss, launch);\n        res.redirect(url);\n    } catch (err) {\n        console.log('err = ' + err);\n        next(err);\n    }\n}));\n\nrouter.get('/callback', co(function* (req, res, next) {\n    try {\n        console.log('1>>>');\n        let code = null, state = null, accessToken = null, patient = 0;\n        console.log('2>>>');\n        ({ code, state } = req.query);\n        console.log('3>>>');\n        const model = yield AuthorizationHelper.accessToken(code, state);\n        console.log('the model is '+ model.state);\n        console.log(model);\n        const html = ReactDomServer.renderToString(\n            React.createElement(Component)\n        );\n        res.header({ state });\n        res.send(html);\n    } catch (err) {\n        console.log('err = ' + err);\n        next(err);\n    }\n}));\n\nexport default router;"]}