{"version":3,"sources":["../../../src/server/controllers/view-renderer-controller.js"],"names":["AuthorizationHelper","Records","Constants","router","Router","get","req","res","next","iss","launch","query","authorize","url","redirect","console","log","code","state","accessToken","patient","send","handleRenderer","s","store","getState","html","renderToString","preloadedState","renderFullPage","JSON","stringify"],"mappings":"AAAA;;;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;IAAYA,mB;;AACZ;;;;AACA;;AACA;;IAAYC,O;;AACZ;;IAAYC,S;;AACZ;;AACA;;;;;;AACA;;AAEA,IAAMC,SAAS,kBAAQC,MAAR,EAAf;;AAEAD,OAAOE,GAAP,CAAW,GAAX,EAAgB,4CAAG,iBAAWC,GAAX,EAAgBC,GAAhB,EAAqBC,IAArB;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAEPC,uBAFO,GAED,IAFC,EAEKC,MAFL,GAEc,IAFd;AAAA,iCAGQJ,IAAIK,KAHZ;AAGRF,uBAHQ,cAGRA,GAHQ;AAGHC,0BAHG,cAGHA,MAHG;AAAA;AAAA,2BAIOV,oBAAoBY,SAApB,CAA8BH,GAA9B,EAAmCC,MAAnC,CAJP;;AAAA;AAILG,uBAJK;;AAKXN,wBAAIO,QAAJ,CAAaD,GAAb;AALW;AAAA;;AAAA;AAAA;AAAA;;AAOXE,4BAAQC,GAAR,CAAY,sBAAZ;AACAR;;AARW;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,CAAH,EAAhB;;AAYAL,OAAOE,GAAP,CAAW,WAAX,EAAwB,4CAAG,kBAAWC,GAAX,EAAgBC,GAAhB,EAAqBC,IAArB;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAEfS,wBAFe,GAER,IAFQ,EAEFC,KAFE,GAEM,IAFN,EAEYC,WAFZ,GAE0B,IAF1B,EAEgCC,OAFhC,GAE0C,CAF1C;AAAA,kCAGAd,IAAIK,KAHJ;AAGhBM,wBAHgB,eAGhBA,IAHgB;AAGVC,yBAHU,eAGVA,KAHU;AAAA;AAAA,2BAIblB,oBAAoBmB,WAApB,CAAgCF,IAAhC,EAAsCC,KAAtC,CAJa;;AAAA;AAKnB;;;;AAIAX,wBAAIc,IAAJ,CAASC,eAAeJ,KAAf,CAAT;AATmB;AAAA;;AAAA;AAAA;AAAA;;AAWnBH,4BAAQC,GAAR,CAAY,uBAAZ;AACAR;;AAZmB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,CAAH,EAAxB;;AAgBA,IAAMc,iBAAiB,SAAjBA,cAAiB,CAACJ,KAAD,EAAW;AAC9BH,YAAQC,GAAR,CAAY,aAAaE,KAAzB;AACA,QAAMK,IAAI,EAAEL,YAAF,EAAV;AACA,QAAMM,QAAQ,wBAAY;AAAA,eAAMD,CAAN;AAAA,KAAZ,CAAd;AACAR,YAAQC,GAAR,CAAYQ,KAAZ;AACAT,YAAQC,GAAR,CAAYQ,MAAMC,QAAN,EAAZ;AACA,QAAMC,OAAO,iBAAeC,cAAf,CACT;AAAA;AAAA,UAAU,OAAOH,KAAjB;AACI;AADJ,KADS,CAAb;AAKA,QAAMI,iBAAiBJ,MAAMC,QAAN,EAAvB;AACA,WAAOI,eAAeA,eAAeH,IAAf,EAAqBE,cAArB,CAAf,CAAP;AACH,CAbD;;AAeA,IAAMC,iBAAiB,SAAjBA,cAAiB,CAACH,IAAD,EAAOE,cAAP,EAA0B;AAC7C,gKAOqBF,IAPrB,yEASqCI,KAAKC,SAAL,CAAeH,cAAf,CATrC;AAcH,CAfD;;kBAiBezB,M","file":"view-renderer-controller.js","sourcesContent":["\"use strict\";\nimport express from 'express';\nimport React from 'react';\nimport ReactDomServer from 'react-dom/server';\nimport Component from '../index';\nimport * as AuthorizationHelper from '../helper/authorization-helper';\nimport co from '../util/wrap';\nimport {get} from '../service/http-service'\nimport * as Records from '../models/models';\nimport * as Constants from '../util/constants';\nimport { createStore } from 'redux'\nimport { Provider } from 'react-redux'\n/*import {DiabeticsChart} from '../../public/javascripts/bundle'*/\n\nconst router = express.Router();\n\nrouter.get('/', co(function* (req, res, next) {\n    try {\n        let iss = null, launch = null;\n        ({ iss, launch } = req.query);\n        const url = yield AuthorizationHelper.authorize(iss, launch);\n        res.redirect(url);\n    } catch (err) {\n        console.log('err = ' + err);\n        next(err);\n    }\n}));\n\nrouter.get('/callback', co(function* (req, res, next) {\n    try {\n        let code = null, state = null, accessToken = null, patient = 0;\n        ({ code, state } = req.query);\n        yield AuthorizationHelper.accessToken(code, state);\n        /*const html = ReactDomServer.renderToString(\n            React.createElement(Component)\n        );\n        res.header({ state });*/\n        res.send(handleRenderer(state));\n    } catch (err) {\n        console.log('err = ' + err);\n        next(err);\n    }\n}));\n\nconst handleRenderer = (state) => {\n    console.log('state = ' + state);\n    const s = { state };\n    const store = createStore(() => s);\n    console.log(store);\n    console.log(store.getState());\n    const html = ReactDomServer.renderToString(\n        <Provider store={store}>\n            <Component/>\n        </Provider>\n    );\n    const preloadedState = store.getState();\n    return renderFullPage(renderFullPage(html, preloadedState))\n}\n\nconst renderFullPage = (html, preloadedState) => {\n    return `\n    <!doctype html>\n    <html>\n      <head>\n        <title>Diabetes Dashboard</title>\n      </head>\n      <body>\n        <div id=\"root\">${html}</div>\n        <script>\n          window.__PRELOADED_STATE__ = ${JSON.stringify(preloadedState)}\n        </script>\n      </body>\n    </html>\n    `\n};\n\nexport default router;"]}