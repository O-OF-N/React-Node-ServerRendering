{"version":3,"sources":["../../../src/server/controllers/view-renderer-controller.js"],"names":["AuthorizationHelper","Records","Constants","router","Router","get","req","res","next","iss","launch","query","authorize","url","redirect","code","state","accessToken","patient","console","log","OBSERVATIONS_FETCH_URL","auth","Authorization","result","html","renderToString","createElement","send"],"mappings":"AAAA;;;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;IAAYA,mB;;AACZ;;;;AACA;;AACA;;IAAYC,O;;AACZ;;IAAYC,S;;;;;;AAEZ,IAAMC,SAAS,kBAAQC,MAAR,EAAf;;AAEAD,OAAOE,GAAP,CAAW,GAAX,EAAgB,4CAAG,iBAAWC,GAAX,EAAgBC,GAAhB,EAAqBC,IAArB;AAAA;;AAAA;AAAA;AAAA;AAAA;AACXC,uBADW,GACL,IADK,EACCC,MADD,GACU,IADV;AAAA,iCAEIJ,IAAIK,KAFR;AAEZF,uBAFY,cAEZA,GAFY;AAEPC,0BAFO,cAEPA,MAFO;AAAA;AAAA,2BAGGV,oBAAoBY,SAApB,CAA8BH,GAA9B,EAAmCC,MAAnC,CAHH;;AAAA;AAGTG,uBAHS;;AAIfN,wBAAIO,QAAJ,CAAaD,GAAb;;AAJe;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,CAAH,EAAhB;;AAOAV,OAAOE,GAAP,CAAW,WAAX,EAAwB,4CAAG,kBAAWC,GAAX,EAAgBC,GAAhB,EAAqBC,IAArB;AAAA;;AAAA;AAAA;AAAA;AAAA;AACnBO,wBADmB,GACZ,IADY,EACPC,KADO,GACC,IADD,EACOC,WADP,GACqB,IADrB,EAC2BC,OAD3B,GACqC,CADrC;AAAA,kCAEJZ,IAAIK,KAFA;AAEpBI,wBAFoB,eAEpBA,IAFoB;AAEdC,yBAFc,eAEdA,KAFc;AAAA;AAAA,2BAGShB,oBAAoBiB,WAApB,CAAgCF,IAAhC,CAHT;;AAAA;AAAA;AAGrBE,+BAHqB,QAGrBA,WAHqB;AAGTC,2BAHS,QAGTA,OAHS;;AAIvBC,4BAAQC,GAAR,gBAAyBF,OAAzB;AACAC,4BAAQC,GAAR,oBAA6BH,WAA7B;AALuB;AAAA,2BAMF,sBAAIf,UAAUmB,sBAAd,EAAsC,IAAIpB,QAAQqB,IAAZ,CAAiB,EAACC,2BAAyBN,WAA1B,EAAjB,CAAtC,CANE;;AAAA;AAMjBO,0BANiB;;AAOvBL,4BAAQC,GAAR,CAAYI,MAAZ;AACMC,wBARiB,GAQV,iBAAeC,cAAf,CACT,gBAAMC,aAAN,iBADS,CARU;;AAWvBpB,wBAAIqB,IAAJ,CAASH,IAAT;;AAXuB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,CAAH,EAAxB;;kBAcetB,M","file":"view-renderer-controller.js","sourcesContent":["\"use strict\";\nimport express from 'express';\nimport React from 'react';\nimport ReactDomServer from 'react-dom/server';\nimport Component from '../index';\nimport * as AuthorizationHelper from '../helper/authorization-helper';\nimport co from '../util/wrap';\nimport {get} from '../service/http-service'\nimport * as Records from '../models/models';\nimport * as Constants from '../util/constants';\n\nconst router = express.Router();\n\nrouter.get('/', co(function* (req, res, next) {\n    let iss = null, launch = null;\n    ({ iss, launch } = req.query);\n    const url = yield AuthorizationHelper.authorize(iss, launch);\n    res.redirect(url);\n}));\n\nrouter.get('/callback', co(function* (req, res, next) {\n    let code = null,state = null, accessToken = null, patient = 0;\n    ({ code, state } = req.query);\n    ({accessToken,patient} =  yield AuthorizationHelper.accessToken(code));\n    console.log(`patient = ${patient}`);\n    console.log(`accessToken = ${accessToken}`);\n    const result = yield get(Constants.OBSERVATIONS_FETCH_URL, new Records.auth({Authorization: `Bearer ${accessToken}`}));\n    console.log(result);\n    const html = ReactDomServer.renderToString(\n        React.createElement(Component)\n    );\n    res.send(html);\n}));\n\nexport default router;"]}